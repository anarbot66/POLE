import React, { useState, useEffect } from "react";
import { useLocation, useNavigate } from "react-router-dom";
import "./BottomNav.css";

const pages = [
  { path: "/standings", label: "Таблица" },
  { path: "/races", label: "Гонки" },
  { path: "/services", label: "Сервисы" },
  { path: "/favorites", label: "Слежу" },
];

const buttons = [
  {
    id: 0,
    label: "Таблица",
    path: "/standings",
    icon: (
      <svg
        width="22"
        height="22"
        viewBox="0 0 22 22"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M19.9375 4.125C20.3172 4.125 20.625 4.4328 20.625 4.8125V17.1875C20.625 17.5672 20.3172 17.875 19.9375 17.875H2.0625C1.6828 17.875 1.375 17.5672 1.375 17.1875V4.8125C1.375 4.4328 1.6828 4.125 2.0625 4.125H19.9375ZM2.0625 2.75C0.923413 2.75 0 3.67341 0 4.8125V17.1875C0 18.3266 0.923413 19.25 2.0625 19.25H19.9375C21.0766 19.25 22 18.3266 22 17.1875V4.8125C22 3.67341 21.0766 2.75 19.9375 2.75H2.0625Z" />
        <path d="M4.125 7.5625C4.125 7.1828 4.4328 6.875 4.8125 6.875H17.1875C17.5672 6.875 17.875 7.1828 17.875 7.5625C17.875 7.9422 17.5672 8.25 17.1875 8.25H4.8125C4.4328 8.25 4.125 7.9422 4.125 7.5625ZM4.125 11C4.125 10.6203 4.4328 10.3125 4.8125 10.3125H17.1875C17.5672 10.3125 17.875 10.6203 17.875 11C17.875 11.3797 17.5672 11.6875 17.1875 11.6875H4.8125C4.4328 11.6875 4.125 11.3797 4.125 11ZM4.125 14.4375C4.125 14.0578 4.4328 13.75 4.8125 13.75H13.0625C13.4422 13.75 13.75 14.0578 13.75 14.4375C13.75 14.8172 13.4422 15.125 13.0625 15.125H4.8125C4.4328 15.125 4.125 14.8172 4.125 14.4375Z" />
      </svg>
    ),
  },
  {
    id: 1,
    label: "Гонки",
    path: "/races",
    icon: (
      <svg
        width="22"
        height="22"
        viewBox="0 0 22 22"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M4.8125 0C5.1922 0 5.5 0.307804 5.5 0.6875V1.375H16.5V0.6875C16.5 0.307804 16.8078 0 17.1875 0C17.5672 0 17.875 0.307804 17.875 0.6875V1.375H19.25C20.7688 1.375 22 2.60622 22 4.125V19.25C22 20.7688 20.7688 22 19.25 22H2.75C1.23122 22 0 20.7688 0 19.25V4.125C0 2.60622 1.23122 1.375 2.75 1.375H4.125V0.6875C4.125 0.307804 4.4328 0 4.8125 0ZM2.75 2.75C1.99061 2.75 1.375 3.36561 1.375 4.125V5.5H20.625V4.125C20.625 3.36561 20.0094 2.75 19.25 2.75H2.75ZM20.625 6.875H1.375V19.25C1.375 20.0094 1.99061 20.625 2.75 20.625H19.25C20.0094 20.625 20.625 20.0094 20.625 19.25V6.875Z" />
        <path d="M15.125 10.3125C15.125 9.9328 15.4328 9.625 15.8125 9.625H17.1875C17.5672 9.625 17.875 9.9328 17.875 10.3125V11.6875C17.875 12.0672 17.5672 12.375 17.1875 12.375H15.8125C15.4328 12.375 15.125 12.0672 15.125 11.6875V10.3125Z" />
        <path d="M11 10.3125C11 9.9328 11.3078 9.625 11.6875 9.625H13.0625C13.4422 9.625 13.75 9.9328 13.75 10.3125V11.6875C13.75 12.0672 13.4422 12.375 13.0625 12.375H11.6875C11.3078 12.375 11 12.0672 11 11.6875V10.3125Z" />
        <path d="M8.25 14.4375C8.25 14.0578 8.5578 13.75 8.9375 13.75H10.3125C10.6922 13.75 11 14.0578 11 14.4375V15.8125C11 16.1922 10.6922 16.5 10.3125 16.5H8.9375C8.5578 16.5 8.25 16.1922 8.25 15.8125V14.4375Z" />
        <path d="M4.125 14.4375C4.125 14.0578 4.4328 13.75 4.8125 13.75H6.1875C6.5672 13.75 6.875 14.0578 6.875 14.4375V15.8125C6.875 16.1922 6.5672 16.5 6.1875 16.5H4.8125C4.4328 16.5 4.125 16.1922 4.125 15.8125V14.4375Z" />
      </svg>
    ),
  },
  {
    id: 2,
    label: "Сервисы",
    path: "/services",
    icon: (
      <svg
        width="22"
        height="22"
        viewBox="0 0 22 22"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M7.5625 2.75C4.90463 2.75 2.75 4.90463 2.75 7.5625V14.4375C2.75 17.0954 4.90463 19.25 7.5625 19.25H14.4375C17.0954 19.25 19.25 17.0954 19.25 14.4375V11C19.25 10.6203 19.5578 10.3125 19.9375 10.3125C20.3172 10.3125 20.625 10.6203 20.625 11V14.4375C20.625 17.8548 17.8548 20.625 14.4375 20.625H7.5625C4.14524 20.625 1.375 17.8548 1.375 14.4375V7.5625C1.375 4.14524 4.14524 1.375 7.5625 1.375H11C11.3797 1.375 11.6875 1.6828 11.6875 2.0625C11.6875 2.4422 11.3797 2.75 11 2.75H7.5625Z" />
        <path d="M22 4.125C22 6.40317 20.1532 8.25 17.875 8.25C15.5968 8.25 13.75 6.40317 13.75 4.125C13.75 1.84683 15.5968 0 17.875 0C20.1532 0 22 1.84683 22 4.125Z" />
      </svg>
    ),
  },
  {
    id: 3,
    label: "Слежу",
    path: "/favorites",
    icon: (
      <svg
        width="22"
        height="22"
        viewBox="0 0 22 22"
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M4.96689 21.2337C4.43553 21.5068 3.83388 21.0296 3.94086 20.4198L5.08173 13.9167L0.238525 9.30135C-0.214099 8.87002 0.0202014 8.08138 0.626562 7.99524L7.36197 7.03841L10.3651 1.08942C10.6357 0.553527 11.3685 0.553527 11.639 1.08942L14.6422 7.03841L21.3776 7.99524C21.9839 8.08138 22.2182 8.87002 21.7656 9.30135L16.9224 13.9167L18.0633 20.4198C18.1703 21.0296 17.5686 21.5068 17.0373 21.2337L11.0021 18.1318L4.96689 21.2337Z" />
      </svg>
    ),
  }
];

const BottomNavigation = ({ setActivePage }) => {
  const location = useLocation();
  const navigate = useNavigate();
  const [activeIndex, setActiveIndex] = useState(() =>
    pages.findIndex((p) => p.path === window.location.pathname) >= 0
      ? pages.findIndex((p) => p.path === window.location.pathname)
      : 0
  );

  useEffect(() => {
    const idx = pages.findIndex((p) => p.path === location.pathname);
    setActiveIndex(idx >= 0 ? idx : 0);
  }, [location.pathname]);

  const handleSelect = (idx) => {
    const btn = pages[idx];
    if (!btn) return;
    setActivePage?.(idx);
    navigate(btn.path);
  };

  return (
    <div className="navGlass">
      <section className="navSection" role="navigation" aria-label="Bottom navigation">
        {buttons.map((btn, idx) => {
          const inputId = `nav-page-${idx}`;
          return (
            <label
              key={btn.id}
              title={btn.label}
              className={`label ${activeIndex === idx ? "active" : ""}`}
              htmlFor={inputId}
            >
              <input
                id={inputId}
                name="page"
                type="radio"
                checked={activeIndex === idx}
                onChange={() => handleSelect(idx)}
                aria-label={btn.label}
              />
              <span className="icon" aria-hidden="true">
                {btn.icon}
              </span>
            </label>
          );
        })}
      </section>
    </div>
  );
};

export default BottomNavigation;
